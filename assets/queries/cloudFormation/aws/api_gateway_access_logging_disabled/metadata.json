{
  "id": "80d45af4-4920-4236-a56e-b7ef419d1941",
  "queryName": "API Gateway V2 stage access logging settings not defined",
  "severity": "MEDIUM",
  "category": "Observability",
  "descriptionText": "API Gateway stages must have access logging and route-level/method-level request logging enabled so request activity is recorded for auditing, troubleshooting, and detecting abuse or suspicious behavior.\n\n For HTTP APIs (`AWS::ApiGatewayV2::Stage`), `AccessLogSettings` must be defined and `DefaultRouteSettings.LoggingLevel` must be present and not set to `OFF` (use values like `INFO` or `ERROR`).\n\n For REST APIs (`AWS::ApiGateway::Stage`), `AccessLogSetting` must be defined and each relevant entry in `MethodSettings` must include a `LoggingLevel` that is not `OFF`.\n\n Resources missing these properties or with `LoggingLevel` set to `OFF` will be flagged.\n\nSecure configuration examples:\n\n```yaml\nMyHttpApiStage:\n  Type: AWS::ApiGatewayV2::Stage\n  Properties:\n    StageName: prod\n    AccessLogSettings:\n      DestinationArn: arn:aws:logs:us-east-1:123456789012:log-group:/aws/apigateway/http-api\n      Format: '$context.identity.sourceIp - $context.requestId - $context.requestTime'\n    DefaultRouteSettings:\n      LoggingLevel: INFO\n```\n\n```yaml\nMyRestApiStage:\n  Type: AWS::ApiGateway::Stage\n  Properties:\n    StageName: prod\n    AccessLogSetting:\n      DestinationArn: arn:aws:logs:us-east-1:123456789012:log-group:/aws/apigateway/rest-api\n      Format: '$context.identity.sourceIp - $context.requestId - $context.requestTime'\n    MethodSettings:\n      - ResourcePath: \"/*\"\n        HttpMethod: \"*\"\n        LoggingLevel: INFO\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudformation/aws/api_gateway_access_logging_disabled",
  "platform": "CloudFormation",
  "descriptionID": "2a69fc63",
  "cloudProvider": "aws",
  "cwe": "778",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigatewayv2-stage.html#cfn-apigatewayv2-stage-accesslogsettings"
}