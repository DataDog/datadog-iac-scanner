{
  "id": "ae03f542-1423-402f-9cef-c834e7ee9583",
  "queryName": "Lambda functions without unique IAM roles",
  "severity": "HIGH",
  "category": "Insecure Configurations",
  "descriptionText": "Lambda functions must not share the same IAM role because sharing roles expands each function's effective permissions beyond what it needs and increases the blast radius if the role is compromised. This rule inspects `AWS::Lambda::Function` resources and their `Properties.Role`. Each function should reference a distinct IAM role (a unique `AWS::IAM::Role` resource or a unique role ARN). Resources where `Properties.Role` is identical to another function's role will be flagged, including identical ARNs, a `Ref` to the same role resource, or equivalent `Fn::GetAtt` results. To remediate, assign separate IAM role resources per function or narrow policies so roles are not reused across multiple functions.\n\nSecure configuration example (each function has its own role):\n\n```yaml\nFunction1Role:\n  Type: AWS::IAM::Role\n  Properties:\n    AssumeRolePolicyDocument:\n      Statement:\n        - Effect: Allow\n          Principal:\n            Service: lambda.amazonaws.com\n          Action: sts:AssumeRole\n    ManagedPolicyArns:\n      - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\nFunction1:\n  Type: AWS::Lambda::Function\n  Properties:\n    FunctionName: function-1\n    Runtime: python3.11\n    Role: !GetAtt Function1Role.Arn\n    Handler: index.handler\n    Code:\n      ZipFile: |\n        def handler(event, context):\n            return {}\n\nFunction2Role:\n  Type: AWS::IAM::Role\n  Properties:\n    AssumeRolePolicyDocument:\n      Statement:\n        - Effect: Allow\n          Principal:\n            Service: lambda.amazonaws.com\n          Action: sts:AssumeRole\n    ManagedPolicyArns:\n      - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\n\nFunction2:\n  Type: AWS::Lambda::Function\n  Properties:\n    FunctionName: function-2\n    Runtime: python3.11\n    Role: !GetAtt Function2Role.Arn\n    Handler: index.handler\n    Code:\n      ZipFile: |\n        def handler(event, context):\n            return {}\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudformation/aws/lambda_functions_without_unique_iam_roles",
  "platform": "CloudFormation",
  "descriptionID": "f919ad7e",
  "cloudProvider": "aws",
  "cwe": "284",
  "oldSeverity": "MEDIUM",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html"
}