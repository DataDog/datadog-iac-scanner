{
  "id": "06ec63e3-9f72-4fe2-a218-2eb9200b8db5",
  "queryName": "API Gateway deployment without access log setting",
  "severity": "MEDIUM",
  "category": "Observability",
  "descriptionText": "API Gateway stages must have access logging enabled so request activity is recorded for detection, auditing, and incident investigation. Without access logs, malicious or anomalous traffic can go undetected and forensic analysis is limited.\n\n In CloudFormation, when an `AWS::ApiGateway::Stage` resource references a deployment (its `Properties.DeploymentId.Ref` equals the deployment logical ID), the corresponding `AWS::ApiGateway::Deployment` must define `StageDescription` and include `StageDescription.AccessLogSetting`.\n\n This rule flags deployments missing `StageDescription` or `StageDescription.AccessLogSetting`. It also verifies that an `AWS::ApiGateway::Stage` exists and that its `DeploymentId.Ref` matches the deployment; mismatched or missing stage associations are reported as incorrect configuration.\n\nSecure configuration example:\n\n```yaml\nMyDeployment:\n  Type: AWS::ApiGateway::Deployment\n  Properties:\n    StageDescription:\n      AccessLogSetting:\n        DestinationArn: arn:aws:logs:us-east-1:123456789012:log-group:/aws/api-gateway/my-api\n        Format: '{\"requestId\":\"$context.requestId\",\"ip\":\"$context.identity.sourceIp\",\"requestTime\":\"$context.requestTime\",\"httpMethod\":\"$context.httpMethod\",\"resourcePath\":\"$context.resourcePath\",\"status\":\"$context.status\"}'\n\nMyStage:\n  Type: AWS::ApiGateway::Stage\n  Properties:\n    StageName: prod\n    DeploymentId:\n      Ref: MyDeployment\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudFormation/aws/api_gateway_deployment_without_access_log_setting",
  "platform": "CloudFormation",
  "descriptionID": "9587628c",
  "cloudProvider": "aws",
  "cwe": "778",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-apigateway-deployment.html"
}
