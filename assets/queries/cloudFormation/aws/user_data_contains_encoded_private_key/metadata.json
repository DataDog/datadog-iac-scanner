{
  "id": "568cc372-ca64-420d-9015-ee347d00d288",
  "queryName": "User data contains encoded private key",
  "severity": "HIGH",
  "category": "Encryption",
  "descriptionText": "Embedding private keys in instance user data (even if base64-encoded) exposes sensitive credentials that can be decoded and used to gain unauthorized access to instances and pivot within your environment.\n\nFor `AWS::AutoScaling::LaunchConfiguration` resources, `Properties.UserData` must not contain PEM private key material. This includes raw PEM headers like `-----BEGIN RSA PRIVATE KEY` or their base64-encoded equivalents. This rule flags `UserData` entries that contain base64 fragments indicative of an encoded PEM header (for example, fragments such as `LS0tLS1CR`) or the raw PEM text.\n\nTo remediate, store keys and secrets in a secure service (AWS Secrets Manager, Systems Manager Parameter Store) or provision access via EC2 key pairs, instance roles, or runtime retrieval from a secure store instead of hard-coding them into user data.\n\nSecure configuration example (retrieve secret from Secrets Manager at runtime):\n\n```yaml\nMyLaunchConfiguration:\n  Type: AWS::AutoScaling::LaunchConfiguration\n  Properties:\n    ImageId: ami-0abcdef1234567890\n    InstanceType: t3.micro\n    IamInstanceProfile: !Ref MyInstanceProfile\n    UserData:\n      Fn::Base64: |\n        #!/bin/bash\n        aws secretsmanager get-secret-value --secret-id my-app-key --region us-east-1 --query SecretString --output text > /tmp/app-key.pem\n        chmod 600 /tmp/app-key.pem\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudformation/aws/user_data_contains_encoded_private_key",
  "platform": "CloudFormation",
  "descriptionID": "b8212287",
  "cloudProvider": "aws",
  "cwe": "326",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-as-launchconfig.html"
}