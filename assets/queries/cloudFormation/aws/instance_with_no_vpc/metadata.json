{
  "id": "8a6d36cd-0bc6-42b7-92c4-67acc8576861",
  "queryName": "Instance with no VPC",
  "severity": "LOW",
  "category": "Insecure Configurations",
  "descriptionText": "EC2 instances must be launched into VPC subnets so they are subject to VPC network controls (routing and security groups) and are not placed in undefined network contexts that can increase exposure risk.\n\nIn AWS CloudFormation:\n- `AWS::EC2::Instance` resources must define `Properties.NetworkInterfaces`.\n- Each `NetworkInterfaces[].SubnetId` that references an `AWS::EC2::Subnet` resource must point to a subnet that defines `Properties.VpcId`.\n\nThis rule flags `AWS::EC2::Instance` resources missing `NetworkInterfaces` and flags subnet resources referenced by `SubnetId` when the referenced `AWS::EC2::Subnet` lacks a `VpcId` property. If you supply `SubnetId` as a literal ID or parameter instead of a template resource reference, ensure that the referenced subnet ID belongs to a VPC. The check validates VPC association only when `SubnetId` points to a template resource.\n\nSecure example with a subnet declaring VpcId and an instance using a network interface that references it:\n\n```yaml\nMySubnet:\n  Type: AWS::EC2::Subnet\n  Properties:\n    VpcId: !Ref MyVPC\n    CidrBlock: 10.0.1.0/24\n\nMyInstance:\n  Type: AWS::EC2::Instance\n  Properties:\n    NetworkInterfaces:\n      - DeviceIndex: 0\n        SubnetId: !Ref MySubnet\n        AssociatePublicIpAddress: false\n        GroupSet:\n          - !Ref MySecurityGroup\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudFormation/aws/instance_with_no_vpc",
  "platform": "CloudFormation",
  "descriptionID": "c2bb3a56",
  "cloudProvider": "aws",
  "cwe": "284",
  "oldSeverity": "MEDIUM",
  "providerUrl": "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-vpc.html"
}
