{
  "id": "f6049677-ec4a-43af-8779-5190b6d03cba",
  "queryName": "KMS allows a wildcard principal",
  "severity": "MEDIUM",
  "category": "Access Control",
  "descriptionText": "KMS key policies that allow a wildcard principal (`*`) grant access to any AWS principal, including external or unauthenticated callers. This can enable unauthorized use of keys and lead to data decryption, key management abuse, or privilege escalation. In AWS CloudFormation, the `AWS::KMS::Key` resource's `Properties.KeyPolicy.Statement[]` must not have an `Effect: Allow` statement where `Principal` is `*` (or contains `*`). Specify explicit principals (AWS account IDs, IAM role or user ARNs, or service principals) and use conditions such as `aws:SourceAccount` or resource ARN restrictions to narrow access. Statements with `Effect: Allow` and `Principal: '*'` will be flagged.\n\nSecure configuration example:\n\n```yaml\nMyKey:\n  Type: AWS::KMS::Key\n  Properties:\n    KeyPolicy:\n      Version: \"2012-10-17\"\n      Statement:\n        - Sid: AllowUseKey\n          Effect: Allow\n          Principal:\n            AWS: \"arn:aws:iam::123456789012:role/MyRole\"\n          Action:\n            - \"kms:Encrypt\"\n            - \"kms:Decrypt\"\n          Resource: \"*\"\n          Condition:\n            StringEquals:\n              aws:SourceAccount: \"123456789012\"\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudFormation/aws/kms_allows_wildcard_principal",
  "platform": "CloudFormation",
  "descriptionID": "0b89626d",
  "cloudProvider": "aws",
  "cwe": "284",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-kms-key.html"
}
