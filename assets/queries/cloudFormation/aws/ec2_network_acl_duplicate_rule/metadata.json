{
  "id": "045ddb54-cfc5-4abb-9e05-e427b2bc96fe",
  "queryName": "EC2 network ACL duplicate rule",
  "severity": "LOW",
  "category": "Networking and Firewall",
  "descriptionText": "Network ACL entries in the same Network ACL must not reuse the same rule number for the same traffic direction, because duplicate rule numbers in one direction can cause one rule to override another and lead to unintended access or disruption of network traffic.\n \n For `AWS::EC2::NetworkAclEntry` resources, `Properties.RuleNumber` must be unique among entries that reference the same `Properties.NetworkAclId` and share the same direction. Direction is determined by the boolean `Properties.Egress` (`true` = egress, `false` = ingress) or `Properties.Ingress`. The rule flags two distinct resources that reference the same `NetworkAclId` with identical `RuleNumber` and identical direction.\n \n Reusing a `RuleNumber` is acceptable only when one entry is ingress and the other is egress.\n\nSecure configuration examples:\n\n```yaml\nMyAclEntryIngress1:\n  Type: AWS::EC2::NetworkAclEntry\n  Properties:\n    NetworkAclId: !Ref MyNetworkAcl\n    RuleNumber: 100\n    Protocol: -1\n    RuleAction: allow\n    Egress: false\n    CidrBlock: 0.0.0.0/0\n\nMyAclEntryIngress2:\n  Type: AWS::EC2::NetworkAclEntry\n  Properties:\n    NetworkAclId: !Ref MyNetworkAcl\n    RuleNumber: 101\n    Protocol: -1\n    RuleAction: deny\n    Egress: false\n    CidrBlock: 10.0.0.0/8\n```\n\nAllowed example (same rule number only when directions differ):\n\n```yaml\nMyAclEntryEgress:\n  Type: AWS::EC2::NetworkAclEntry\n  Properties:\n    NetworkAclId: !Ref MyNetworkAcl\n    RuleNumber: 100\n    Protocol: -1\n    RuleAction: allow\n    Egress: true\n    CidrBlock: 0.0.0.0/0\n\nMyAclEntryIngress:\n  Type: AWS::EC2::NetworkAclEntry\n  Properties:\n    NetworkAclId: !Ref MyNetworkAcl\n    RuleNumber: 100\n    Protocol: -1\n    RuleAction: deny\n    Egress: false\n    CidrBlock: 10.0.0.0/8\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudformation/aws/ec2_network_acl_duplicate_rule",
  "platform": "CloudFormation",
  "descriptionID": "27e96b39",
  "cloudProvider": "aws",
  "cwe": "358",
  "oldSeverity": "LOW",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-network-acl-entry.html#cfn-ec2-networkaclentry-rulenumber"
}