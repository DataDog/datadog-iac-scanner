{
  "id": "c44c95fc-ae92-4bb8-bdf8-bb9bc412004a",
  "queryName": "EC2 public instance exposed through subnet",
  "severity": "MEDIUM",
  "category": "Networking and Firewall",
  "descriptionText": "EC2 instances should not be assigned public IP addresses in subnets that have a default route to the internet, because doing so exposes those instances to unrestricted inbound and outbound traffic and increases the risk of unauthorized access, exploitation, and data exfiltration. This rule checks `AWS::EC2::Instance` resources' `NetworkInterfaces[*].AssociatePublicIpAddress` property. It flags instances where this is `true` and the subnet referenced by `NetworkInterfaces[*].SubnetId` is associated (via `AWS::EC2::SubnetRouteTableAssociation`) with a route table that contains an `AWS::EC2::Route` having `DestinationCidrBlock` set to `0.0.0.0/0` or `DestinationIpv6CidrBlock` set to `::/0`.\n \n To remediate, avoid assigning public IPs to instances in those subnets, place workloads in private subnets that use a NAT gateway for outbound access, or remove/restrict the default `0.0.0.0/0` or `::/0` route from the subnet's route table.\n\nSecure configuration example (instance in private subnet):\n\n```yaml\nMyInstance:\n  Type: AWS::EC2::Instance\n  Properties:\n    ImageId: ami-0abcdef1234567890\n    InstanceType: t3.micro\n    NetworkInterfaces:\n      - AssociatePublicIpAddress: false\n        SubnetId: !Ref MyPrivateSubnet\n        DeviceIndex: 0\n```",
  "descriptionUrl": "https://docs.datadoghq.com/security/code_security/iac_security/iac_rules/cloudformation/aws/ec2_public_instance_exposed_through_subnet",
  "platform": "CloudFormation",
  "descriptionID": "163e9a52",
  "cloudProvider": "aws",
  "cwe": "668",
  "oldSeverity": "HIGH",
  "providerUrl": "https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-ec2-route.html"
}